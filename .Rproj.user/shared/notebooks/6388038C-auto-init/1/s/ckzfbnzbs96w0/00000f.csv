"0","# Function to fetch data from Supabase using REST API"
"0","fetch_supabase_data <- function(url, api_key, table_name, query_params = NULL) {"
"0","  # Build the API endpoint"
"0","  endpoint <- paste0(url, ""/rest/v1/"", table_name)"
"0","  "
"0","  # Prepare headers"
"0","  headers <- c("
"0","    ""apikey"" = api_key,"
"0","    ""Authorization"" = paste(""Bearer"", api_key),"
"0","    ""Content-Type"" = ""application/json"","
"0","    ""Prefer"" = ""return=representation"""
"0","  )"
"0","  "
"0","  # Build query parameters"
"0","  if (is.null(query_params)) {"
"0","    # Default: get data from last 7 days"
"0","    query_params <- list("
"0","      # Using Supabase's PostgREST syntax"
"0","      `created_at` = paste0(""gte."", format(Sys.Date() - 7, ""%Y-%m-%d""))"
"0","    )"
"0","  }"
"0","  "
"0","  tryCatch({"
"0","    # Make the GET request"
"0","    response <- GET("
"0","      url = endpoint,"
"0","      add_headers(.headers = headers),"
"0","      query = query_params"
"0","    )"
"0","    "
"0","    # Check for successful response"
"0","    if (http_status(response)$category == ""Success"") {"
"0","      # Parse the JSON response"
"0","      data <- fromJSON(content(response, ""text"", encoding = ""UTF-8""), flatten = TRUE)"
"0","      "
"0","      # Log success"
"0","      write(""SUCCESS"", ""query_status.txt"")"
"0","      "
"0","      # Convert to data frame if it isn't already"
"0","      if (!is.data.frame(data)) {"
"0","        if (length(data) == 0) {"
"0","          # Return empty data frame with expected columns"
"0","          data <- data.frame("
"0","            id = integer(0),"
"0","            value = numeric(0),"
"0","            created_at = character(0),"
"0","            description = character(0)"
"0","          )"
"0","        } else {"
"0","          data <- as.data.frame(data)"
"0","        }"
"0","      }"
"0","      "
"0","      return(data)"
"0","    } else {"
"0","      # Log error"
"0","      error_msg <- paste(""API Error:"", http_status(response)$message, "
"0","                        ""-"", content(response, ""text"", encoding = ""UTF-8""))"
"0","      write(error_msg, ""error_log.txt"")"
"0","      write(""FAILED"", ""query_status.txt"")"
"0","      stop(error_msg)"
"0","    }"
"0","  }, error = function(e) {"
"0","    # Log connection errors"
"0","    write(paste(""ERROR:"", e$message), ""error_log.txt"")"
"0","    write(""FAILED"", ""query_status.txt"")"
"0","    stop(paste(""Supabase API request failed:"", e$message))"
"0","  })"
"0","}"
"0",""
"0","# Fetch data from Supabase"
"0","data <- fetch_supabase_data("
"0","  url = supabase_url,"
"0","  api_key = supabase_key,"
"0","  table_name = ""init_sample_table"""
"0",")"
